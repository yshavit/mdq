[given]
md = '''
- AAA: [footnote [^1] in a link](https://example.com)
- BBB: footnote contains footnote[^2]
- CCC: footnote contains link[^3]

[^1]: the link's footnote text
[^2]: this footnote contains[^a] a footnote
[^3]: this footnote contains a [link][3a]
[^a]: this is the footnote's footnote

[3a]: https://example.com/3a
'''

[chained]
needed = false


[expect."just link contains footnote"]
cli_args = ['- AAA']
output = '''
- AAA: [footnote [^1] in a link][1]

[1]: https://example.com
[^1]: the link's footnote text
'''

[expect."just link contains footnote: json"]
cli_args = ['- AAA', '--output', 'json']
output = '''
{
    "items": [
        {
            "list_item": {
                "item": [
                    {
                        "paragraph": "AAA: [footnote [^1] in a link][1]"
                    }
                ]
            }
        }
    ],
    "links": {
        "1": {
            "url": "https://example.com"
        }
    },
    "footnotes": {
        "1": [
            {
                "paragraph": "the link's footnote text"
            }
        ]
    }
}
'''


[expect."just footnote contains footnote"]
cli_args = ['- BBB']
output = '''
- BBB: footnote contains footnote[^1]

[^1]: this footnote contains[^2] a footnote

[^2]: this is the footnote's footnote
'''


[expect."just footnote contains footnote: json"]
cli_args = ['- BBB | P: *', '--output', 'json']
output_json = true
output = '''
{
  "items": [
    {
      "paragraph": "BBB: footnote contains footnote[^1]"
    }
  ],
  "footnotes": {
    "1": [
      {
        "paragraph": "this footnote contains[^2] a footnote"
      }
    ],
    "2": [
      {
        "paragraph": "this is the footnote's footnote"
      }
    ]
  }
}
'''


[expect."just footnote contains link"]
cli_args = ['- CCC']
output = '''
- CCC: footnote contains link[^1]

[^1]: this footnote contains a [link][3a]

[3a]: https://example.com/3a
'''


[expect."just footnote contains link: json"]
cli_args = ['- CCC', '--output', 'json']
output_json = true
output = '''
{
  "items": [
    {
      "list_item": {
        "item": [
          {
            "paragraph": "CCC: footnote contains link[^1]"
          }
        ]
      }
    }
  ],
  "footnotes": {
    "1": [
      {
        "paragraph": "this footnote contains a [link][3a]"
      }
    ]
  },
  "links": {
    "3a": {
      "url": "https://example.com/3a"
    }
  }
}
'''
